repeat task.wait() until game:IsLoaded()

--// SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local player = Players.LocalPlayer

--// CONFIG
local API_URL = "http://127.0.0.1:8080/next"  -- üîó ƒê·ªãa ch·ªâ server Python
local CHECK_INTERVAL = 0.5                    -- m·ªói 0.5 gi√¢y h·ªèi 1 l·∫ßn
local AUTO_KICK_TIME = 15 * 60                -- t·ª± kick sau 15 ph√∫t (ƒë·ªïi server)

print("üöÄ CT Hopper Client ƒëang ch·∫°y... (Mode: HTTP Request)")

--// AUTO-KICK SAU 15 PH√öT
task.spawn(function()
    task.wait(AUTO_KICK_TIME)
    print("‚è∞ H·∫øt 15 ph√∫t, kick ƒë·ªÉ l√†m m·ªõi server...")
    TeleportService:Teleport(game.PlaceId, player)
end)

--// H√ÄM G·ªåI PYTHON SERVER NH·∫¨N JOBID
local function getNextJob()
    local req = http_request or request or syn.request or fluxus.request
    if not req then
        warn("‚ùå Executor c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ http_request.")
        return nil
    end

    local success, res = pcall(function()
        return req({
            Url = API_URL,
            Method = "GET",
            Headers = {["Content-Type"] = "application/json"}
        })
    end)

    if not success or not res or not res.Body then
        warn("‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server Python.")
        return nil
    end

    local data
    pcall(function()
        data = HttpService:JSONDecode(res.Body)
    end)

    if not data then
        warn("‚ö†Ô∏è Kh√¥ng th·ªÉ decode JSON t·ª´ Python.")
        return nil
    end

    if data.jobId then
        print("üéØ Nh·∫≠n ƒë∆∞·ª£c JobId m·ªõi:", data.jobId)
        return data.jobId, data.placeId
    else
        print("‚è≥ Ch∆∞a c√≥ JobId kh·∫£ d·ª•ng:", data.message or "ƒëang ch·ªù qu√©t...")
        return nil
    end
end

--// MAIN LOOP
while true do
    local jobId, placeId = getNextJob()
    if jobId and placeId then
        print("üöÄ Teleporting ƒë·∫øn server m·ªõi:", jobId)
        task.wait(0.5) -- Optional delay to avoid rapid consecutive requests
        pcall(function()
            TeleportService:TeleportToPlaceInstance(placeId, jobId, player)
        end)
    end
    task.wait(CHECK_INTERVAL)
end
